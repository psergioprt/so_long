#include "so_long.h"
#define MAP_FILE "map.ber"
#define MAP_FILE1 "map2.ber"

int main(void)
{
	int		fd;
	int		row;
	int		line_count;
	int		max_line_length;
	int		line_length;
	int		i;
	int		j;
	char	*line;
	char	**map;

	row = 0;
	line_count = 0;
	max_line_length = 0;
	fd = open(MAP_FILE, O_RDONLY);
	i = 0;
	if (fd == -1)
		return (1);
	while ((line = get_next_line(fd)) != NULL)
	{
		line_count++;
		line_length = ft_strlen(line);
		if (line_length > max_line_length)
			max_line_length = line_length;
		free (line);
	}
	lseek(fd, 0, SEEK_SET);
	map = malloc(sizeof(char *) * line_count);
	if (!map)
	{
		close (fd);
		return (1);
	}
	while (i < line_count)
	{
		map[i] = malloc(sizeof(char) * (max_line_length + 1));
		if (!map[i])
		{
			j = 0;
			while (j < i)
			{
				free(map);
				j++;
			}
		free (map);
		close (fd);
		return (1);
		}
		i++;
	}

	while ((line = get_next_line(fd)) != NULL)
	{
		ft_strcpy(map[row++], line);
		free(line);
	}
	close(fd);
	i = 0;
	while (i < row)
		ft_printf("%s\n", map[i++]);
	i = 0;
	while (i < line_count)
		free(map[i++]);
	free(map);
	return (0);
}
